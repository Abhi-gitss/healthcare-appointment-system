<!DOCTYPE html>
<html lang="zxx">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="description" content="Orbitor,business,company,agency,modern,bootstrap4,tech,software">
	<meta name="author" content="themefisher.com">

	<title>Vita- Health & Care Medical template</title>

	<!-- Favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />

	<!-- bootstrap.min css -->
	<link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
	<!-- Icon Font Css -->
	<link rel="stylesheet" href="plugins/icofont/icofont.min.css">
	<!-- Slick Slider  CSS -->
	<link rel="stylesheet" href="plugins/slick-carousel/slick/slick.css">
	<link rel="stylesheet" href="plugins/slick-carousel/slick/slick-theme.css">

	<!-- Main Stylesheet -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/theme.css">
	<link rel="stylesheet" href="css/phase4-enhancements.css">

</head>

<body id="top">

	<header>
		<div class="header-top-bar">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-lg-6">
						<ul class="top-bar-info list-inline-item pl-0 mb-0">
							<li class="list-inline-item"><a href="mailto:support@gmail.com"><i
										class="icofont-support-faq mr-2"></i>support@vita.com</a></li>
							<li class="list-inline-item"><i class="icofont-location-pin mr-2"></i>Noida, New
								Delhi, INDIA </li>
						</ul>
					</div>
					<div class="col-lg-6">
						<div class="text-lg-right top-right-bar mt-2 mt-lg-0">
							<a href="tel:+23-345-67890">
								<span>Call Now : </span>
								<span class="h4">9348039485</span>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<nav class="navbar navbar-expand-lg navigation" id="navbar">
			<div class="container">
				<a class="navbar-brand" href="index.html">
					<img src="images/unnamed.png" alt="" class="img-fluid">
				</a>

				<button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarmain"
					aria-controls="navbarmain" aria-expanded="false" aria-label="Toggle navigation">
					<span class="icofont-navigation-menu"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarmain">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item active">
							<a class="nav-link" href="index.html">Home</a>
						</li>
						<li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
						<li class="nav-item"><a class="nav-link" href="service.html">Services</a></li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="department.html" id="dropdown02"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Department <i
									class="icofont-thin-down"></i></a>
							<ul class="dropdown-menu" aria-labelledby="dropdown02">
								<li><a class="dropdown-item" href="department.html">Departments</a></li>
								<li><a class="dropdown-item" href="department-single.html">Department Single</a></li>
							</ul>
						</li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="doctor.html" id="dropdown03"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Doctors <i
									class="icofont-thin-down"></i></a>
							<ul class="dropdown-menu" aria-labelledby="dropdown03">
								<li><a class="dropdown-item" href="doctor.html">Doctors</a></li>
								<li><a class="dropdown-item" href="doctor-single.html">Doctor Single</a></li>
								<li><a class="dropdown-item" href="appoinment.html">Appoinment</a></li>
							</ul>
						</li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="blog-sidebar.html" id="dropdown05"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog <i
									class="icofont-thin-down"></i></a>
							<ul class="dropdown-menu" aria-labelledby="dropdown05">
								<li><a class="dropdown-item" href="blog-sidebar.html">Blog with Sidebar</a></li>

								<li><a class="dropdown-item" href="blog-single.html">Blog Single</a></li>
							</ul>
						</li>
						<li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>



	<section class="page-title bg-1">
		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="block text-center">
						<span class="text-white">Book your Seat</span>
						<h1 class="text-capitalize mb-5 text-lg">Appoinment</h1>

						<!-- <ul class="list-inline breadcumb-nav">
            <li class="list-inline-item"><a href="index.html" class="text-white">Home</a></li>
            <li class="list-inline-item"><span class="text-white">/</span></li>
            <li class="list-inline-item"><a href="#" class="text-white-50">Book your Seat</a></li>
          </ul> -->
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="appoinment section">
		<div class="container">
			<div class="row">
				<div class="col-lg-4">
					<div class="mt-3">
						<div class="feature-icon mb-3">
							<i class="icofont-support text-lg"></i>
						</div>
						<span class="h3">Call for an Emergency Service!</span>
						<h2 class="text-color mt-3">9348039485 </h2>
					</div>
				</div>

				<div class="col-lg-8">
					<div class="appoinment-wrap mt-5 mt-lg-0 pl-lg-5">
						<h2 class="mb-2 title-color">Book an appoinment</h2>
						<p class="mb-4">We will provide you best Doctors here .</p>
						<form id="appointment-form" class="appoinment-form" autocomplete="off">
							<div class="row">
								<div class="col-lg-6">
									<div class="form-group">
										<select class="form-control" id="department" name="department" required>
											<option value="">Choose Department</option>
											<option value="Cardiology">Heart Care</option>
											<option value=" Neurology">Neuro Sciences</option>
											<option value="Orthopedics">Bone & Joint</option>
											<option value=" Dermatology">Skin Care</option>
											<option value=" Gynecology">Women Health</option>
											<option value=" Pediatrics">Child Care</option>
											<option value="Dentist">Dentist</option>
										</select>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<select class="form-control" id="doctor_id" name="doctor_id" required>
											<option value="0">Select Doctor</option>
											<option value="1">Dr. Aditi Sharma</option>
											<option value="2">Dr. Rajeev Kumar</option>
											<option value="3">Dr. Meera Singh</option>
											<option value="4">Dr. Sunil Grover</option>
											<option value="5">Dr. Pooja Chawla</option>
											<option value="6">Dr. Amitabh Joshi</option>
											<option value="7">Dr. Shekhar</option>
										</select>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="patient_id" id="patient_id" type="number" class="form-control"
											placeholder="Patient ID" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="appointment_date" id="appointment_date" type="date"
											class="form-control" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<select name="appointment_time" id="appointment_time" class="form-control" required>
											<option value="">Select time</option>
										</select>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="reason" id="reason" type="text" class="form-control"
											placeholder="Reason for appointment" required>
									</div>
								</div>
							</div>
							<button type="submit" class="btn btn-main btn-round-full">Book Appointment</button>
							<div id="booking-warning" class="text-danger mt-2" style="display:none; font-weight:600;">Doctor's are all set for today. You can book Tomorrow.</div>
							<div class="mt-3 text-center">
								<p class="text-muted">Already have appointments? <a href="patient-portal.html" style="color: #1977cc; font-weight: 600;">View & Manage Your Appointments</a></p>
							</div>

						</form>


						<script>
							document.getElementById('appointment-form').addEventListener('submit', function (e) {
								e.preventDefault();

								const payload = {
									patient_id: Number(document.getElementById('patient_id').value),
									doctor_id: Number(document.getElementById('doctor_id').value),
									department: document.getElementById('department').value,
									appointment_date: document.getElementById('appointment_date').value,
									appointment_time: document.getElementById('appointment_time').value,
									status: "Scheduled",
									reason: document.getElementById('reason').value
								};

								const warnEl = document.getElementById('booking-warning');
								// Clear previous warning
								warnEl.style.display = 'none';
								warnEl.textContent = '';

								fetch('http://localhost:8080/api/appointments', {
									method: 'POST',
									headers: { 'Content-Type': 'application/json' },
									body: JSON.stringify(payload)
								})
									.then(async (response) => {
										const raw = await response.text();
										let data = null;
										try { data = raw ? JSON.parse(raw) : null; } catch (_) { /* not json */ }

										// Handle non-OK with JSON error
										if (!response.ok) {
											if (data && data.error === 'PATIENT_NOT_FOUND') {
												showToast('Please register first to book an appointment.', 'warning');
												document.getElementById('register-form').scrollIntoView({ behavior: 'smooth' });
												// Stop chain
												return Promise.reject(new Error('PATIENT_NOT_FOUND'));
											}
											if (data && data.error === 'DAILY_LIMIT_REACHED') {
												// Show inline red warning below the button (no popup)
												warnEl.textContent = "Doctor's are all set for today. You can book Tomorrow.";
												warnEl.style.display = 'block';
												return Promise.reject(new Error('DAILY_LIMIT_REACHED'));
											}
											const msg = (data && (data.message || data.error)) || raw || ('HTTP ' + response.status);
											return Promise.reject(new Error(msg));
										}

										// OK response
										return data;
									})
									.then(data => {
										showToast('Appointment booked successfully!', 'success');
										// Optionally, redirect after success:
										// window.location.href = 'confirmation.html';
									})
									.catch(err => {
										if (err && (err.message === 'PATIENT_NOT_FOUND' || err.message === 'DAILY_LIMIT_REACHED')) return; // already handled inline
										showToast('Error booking appointment: ' + err.message, 'error');
									});
							});
						</script>

                    <!-- Toast container -->
                    <div id="toast-container" style="position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 1050; width: min(92vw, 480px);"></div>

                    <script>
                        function showToast(message, type = 'info') {
                            const colors = {
                                success: '#2e7d32',
                                error: '#c62828',
                                warning: '#ed6c02',
                                info: '#1565c0'
                            };
                            const bg = colors[type] || colors.info;
                            const el = document.createElement('div');
                            el.textContent = message;
                            el.style.cssText = `color:#fff;background:${bg};padding:12px 16px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,.24);margin-top:8px;opacity:0;transform:translateY(8px);transition:all .25s ease; font-weight:600;`;
                            document.getElementById('toast-container').appendChild(el);
                            requestAnimationFrame(()=>{ el.style.opacity='1'; el.style.transform='translateY(0)'; });
                            setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(8px)'; setTimeout(()=> el.remove(), 250); }, 3000);
                        }

                        // Smart time slots based on selected date
                        const timeSelect = document.getElementById('appointment_time');
                        const dateInput = document.getElementById('appointment_date');

                        function getWindowForDate(date) {
                            const d = new Date(date + 'T00:00:00');
                            const day = d.getDay(); // 0=Sun
                            let start = '08:00';
                            let end = '17:00';
                            if (day === 4 || day === 5) { // Thu, Fri
                                start = '09:00';
                            } else if (day === 6 || day === 0) { // Sat, Sun
                                start = '10:00';
                            }
                            return { start, end };
                        }

                        function toMinutes(hhmm) { const [h,m] = hhmm.split(':').map(Number); return h*60+m; }
                        function fromMinutes(mins) { const h = String(Math.floor(mins/60)).padStart(2,'0'); const m = String(mins%60).padStart(2,'0'); return `${h}:${m}`; }

                        function generateSlots() {
                            timeSelect.innerHTML = '<option value="">Select time</option>';
                            const date = dateInput.value;
                            if (!date) return;
                            const { start, end } = getWindowForDate(date);
                            const step = 30; // minutes
                            const now = new Date();
                            const isToday = new Date(date).toDateString() === now.toDateString();
                            const cutoffMins = isToday ? now.getHours()*60 + now.getMinutes() : -1;

                            for (let t = toMinutes(start); t <= toMinutes(end); t += step) {
                                const hhmm = fromMinutes(t);
                                const opt = document.createElement('option');
                                opt.value = hhmm;
                                opt.textContent = hhmm;
                                if (isToday && t <= cutoffMins) {
                                    opt.disabled = true;
                                }
                                timeSelect.appendChild(opt);
                            }
                        }

                        dateInput.addEventListener('change', generateSlots);
                        // Initialize on load (if date preset)
                        if (dateInput.value) generateSlots();
                    </script>


					</div>
				</div>
			</div>
		</div>
		</div>
	</section>

	<section class="register section">
		<div class="container">
			<div class="row">
				<div class="col-lg-4">
					<div class="mt-3">
						<div class="feature-icon mb-3">
							<i class="icofont-user text-lg"></i>
						</div>
						<span class="h3">Register New Patient</span>
						<h2 class="text-color mt-3">Become a Member</h2>
					</div>
				</div>
				<div class="col-lg-8">
					<div class="register-wrap mt-5 mt-lg-0 pl-lg-5">
						<h2 class="mb-2 title-color">Register</h2>
						<p class="mb-4">Fill in your details to register as a patient.</p>
						<form id="register-form" class="register-form" autocomplete="off">
							<div class="row">
								<div class="col-lg-6">
									<div class="form-group">
										<input name="name" id="name" type="text" class="form-control"
											placeholder="Full Name" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="email" id="email" type="email" class="form-control"
											placeholder="Email" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="phone" id="phone" type="text" class="form-control"
											placeholder="Phone" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="date_of_birth" id="dob" type="date" class="form-control" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<select name="gender" id="gender" class="form-control" required>
											<option value="" disabled selected>Gender</option>
											<option value="Male">Male</option>
											<option value="Female">Female</option>
											<option value="Other">Other</option>
										</select>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="address" id="address" type="text" class="form-control"
											placeholder="Address" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<input name="blood_group" id="blood_group" type="text" class="form-control"
											placeholder="Blood Group (e.g., A+)" required>
									</div>
								</div>
							</div>
							<button type="submit" class="btn btn-main btn-round-full">Register</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</section>

	<script>
		document.getElementById('register-form').addEventListener('submit', function (e) {
			e.preventDefault();
			const payload = {
				name: document.getElementById('name').value,
				email: document.getElementById('email').value,
				phone: document.getElementById('phone').value,
				date_of_birth: document.getElementById('dob').value,
				gender: document.getElementById('gender').value,
				address: document.getElementById('address').value,
				blood_group: document.getElementById('blood_group').value
			};
			fetch('http://localhost:8080/api/patients', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(payload)
			})
				.then(response => {
					if (!response.ok) throw new Error('Network response was not ok');
					return response.json();
				})
				.then(data => {
					showToast('Registration successful!', 'success');
					document.getElementById('register-form').reset();
					// Optionally redirect or handle next steps
				})
				.catch(err => {
					showToast('Error registering patient: ' + err.message, 'error');
				});
		});
	</script>



	<!-- footer Start -->
	<footer class="footer section gray-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 mr-auto col-sm-6">
					<div class="widget mb-5 mb-lg-0">
						<div class="logo mb-4">
							<img src="images/unnamed.png" alt="" class="img-fluid">
						</div>
						<p>Tempora dolorem voluptatum nam vero assumenda voluptate, facilis ad eos obcaecati tenetur
							veritatis eveniet distinctio possimus.</p>

						<ul class="list-inline footer-socials mt-4">
							<li class="list-inline-item"><a href="https://www.facebook.com/themefisher"><i
										class="icofont-facebook"></i></a></li>
							<li class="list-inline-item"><a href="https://twitter.com/themefisher"><i
										class="icofont-twitter"></i></a></li>
							<li class="list-inline-item"><a href="https://www.pinterest.com/themefisher/"><i
										class="icofont-linkedin"></i></a></li>
						</ul>
					</div>
				</div>

				<div class="col-lg-2 col-md-6 col-sm-6">
					<div class="widget mb-5 mb-lg-0">
						<h4 class="text-capitalize mb-3">Department</h4>
						<div class="divider mb-4"></div>

						<ul class="list-unstyled footer-menu lh-35">
							<li><a href="#">Surgery </a></li>
							<li><a href="#">Wome's Health</a></li>
							<li><a href="#">Radiology</a></li>
							<li><a href="#">Cardioc</a></li>
							<li><a href="#">Medicine</a></li>
						</ul>
					</div>
				</div>

				<div class="col-lg-2 col-md-6 col-sm-6">
					<div class="widget mb-5 mb-lg-0">
						<h4 class="text-capitalize mb-3">Support</h4>
						<div class="divider mb-4"></div>

						<ul class="list-unstyled footer-menu lh-35">
							<li><a href="#">Terms & Conditions</a></li>
							<li><a href="#">Privacy Policy</a></li>
							<li><a href="#">Company Support </a></li>
							<li><a href="#">FAQuestions</a></li>
							<li><a href="#">Company Licence</a></li>
						</ul>
					</div>
				</div>

				<div class="col-lg-3 col-md-6 col-sm-6">
					<div class="widget widget-contact mb-5 mb-lg-0">
						<h4 class="text-capitalize mb-3">Get in Touch</h4>
						<div class="divider mb-4"></div>

						<div class="footer-contact-block mb-4">
							<div class="icon d-flex align-items-center">
								<i class="icofont-email mr-3"></i>
								<span class="h6 mb-0">Support Available for 24/7</span>
							</div>
							<h4 class="mt-2"><a href="tel:+23-345-67890">Support@email.com</a></h4>
						</div>

						<div class="footer-contact-block">
							<div class="icon d-flex align-items-center">
								<i class="icofont-support mr-3"></i>
								<span class="h6 mb-0">Mon to Fri : 08:30 - 18:00</span>
							</div>
							<h4 class="mt-2"><a href="tel:+23-345-67890">+23-456-6588</a></h4>
						</div>
					</div>
				</div>
			</div>

			<div class="footer-btm py-4 mt-5">
				<div class="row align-items-center justify-content-between">
					<div class="col-lg-6">
						<!-- <div class="copyright">
							&copy; Copyright Reserved to <span class="text-color">Novena</span> by <a
								href="https://themefisher.com/" target="_blank">Themefisher</a>
						</div> -->
					</div>
					<div class="col-lg-6">
						<div class="subscribe-form text-lg-right mt-5 mt-lg-0">
							<form action="#" class="subscribe">
								<input type="text" class="form-control" placeholder="Your Email address">
								<a href="#" class="btn btn-main-2 btn-round-full">Subscribe</a>
							</form>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-4">
						<a class="backtop js-scroll-trigger" href="#top">
							<i class="icofont-long-arrow-up"></i>
						</a>
					</div>
				</div>
			</div>
		</div>
	</footer>


	<!-- 
    Essential Scripts
    =====================================-->


	<!-- Main jQuery -->
	<script src="plugins/jquery/jquery.js"></script>
	<!-- Bootstrap 4.3.2 -->
	<script src="plugins/bootstrap/js/popper.js"></script>
	<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="plugins/counterup/jquery.easing.js"></script>
	<!-- Slick Slider -->
	<script src="plugins/slick-carousel/slick/slick.min.js"></script>
	<!-- Counterup -->
	<script src="plugins/counterup/jquery.waypoints.min.js"></script>

	<script src="plugins/shuffle/shuffle.min.js"></script>
	<script src="plugins/counterup/jquery.counterup.min.js"></script>
	<!-- Google Map -->
	<script src="plugins/google-map/map.js"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkeLMlsiwzp6b3Gnaxd86lvakimwGA6UA&callback=initMap"></script>

	<script src="js/script.js"></script>
	<script src="js/contact.js"></script>

	<!-- this js code juts gives doctors name after writing down his department-->
	<script>
		document.getElementById('department').addEventListener('change', function () {
			var dept = this.value;
			const doctorSelect = document.getElementById('doctor_id');
			doctorSelect.innerHTML = '';
			const loadingOpt = document.createElement('option');
			loadingOpt.text = 'Loading doctors...';
			loadingOpt.value = '';
			doctorSelect.appendChild(loadingOpt);
			doctorSelect.disabled = true;

			fetch('/api/doctors?department=' + encodeURIComponent(dept))
				.then(response => {
					if (!response.ok) { throw new Error('Failed to load doctors (' + response.status + ')'); }
					return response.json();
				})
				.then(doctors => {
					doctorSelect.innerHTML = '';
					var placeholder = document.createElement('option');
					placeholder.value = '';
					placeholder.text = 'Select Doctor';
					doctorSelect.appendChild(placeholder);
					doctors.forEach(function (doc) {
						var opt = document.createElement('option');
						opt.value = doc.doctor_id;
						opt.text = doc.name;
						doctorSelect.appendChild(opt);
					});
					doctorSelect.disabled = false;
				})
				.catch(err => { doctorSelect.disabled = false; showToast('Unable to load doctors: ' + err.message, 'error'); });
		});

	</script>


</body>

</html>